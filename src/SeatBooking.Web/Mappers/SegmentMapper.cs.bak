using SeatBooking.Domain.SegmentAggregate;
using SeatBooking.Web.Models;
using System.Linq;

namespace SeatBooking.Web.Mappers;

public static class SegmentMapper
{
    public static Segment ToDomain(this SegmentDto dto)
    {
        // Handle StopAirports as List<string> (from List<object> in FlightDto)
        var stopAirports = dto.Flight.StopAirports?
            .Select(sa => sa?.ToString() ?? string.Empty)
            .Where(code => !string.IsNullOrWhiteSpace(code))
            .ToList() ?? new List<string>();

        return new Segment(
            dto.SegmentOfferInformation.FlightsMiles,
            dto.SegmentOfferInformation.AwardFare,
            dto.Duration,
            dto.CabinClass,
            dto.Equipment,
            new FlightInfo(
                dto.Flight.FlightNumber,
                dto.Flight.OperatingFlightNumber,
                dto.Flight.AirlineCode,
                dto.Flight.OperatingAirlineCode,
                stopAirports,
                dto.Flight.DepartureTerminal,
                dto.Flight.ArrivalTerminal
            ),
            dto.Origin,
            dto.Destination,
            DateTime.Parse(dto.Departure),
            DateTime.Parse(dto.Arrival),
            dto.BookingClass,
            dto.LayoverDuration,
            dto.FareBasis,
            dto.SubjectToGovernmentApproval,
            dto.SegmentRef
        );
    }
}